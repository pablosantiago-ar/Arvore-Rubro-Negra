<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Árvore Vermelho-Preta - Engenharia de Computação S3</title>
<style>
  /* Reset básico */
  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #ffe5e5, #fff0f0);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem 1rem;
    color: #2c2c2c;
  }

  header {
    text-align: center;
    margin-bottom: 1rem;
  }

  header h1 {
    margin: 0;
    font-weight: 700;
    color: #b71c1c;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }
  header p {
    margin: 0.2rem 0 1.5rem;
    font-size: 1.15rem;
    color: #4a4a4a;
    font-style: italic;
  }

  #generateBtn {
    background: #b71c1c;
    border: none;
    color: white;
    font-size: 1.25rem;
    padding: 0.7rem 1.5rem;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 4px 10px rgb(183 28 28 / 0.5);
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    user-select: none;
    margin-bottom: 1.5rem;
  }
  #generateBtn:hover:not(:disabled) {
    background: #7f1414;
    box-shadow: 0 6px 14px rgb(127 20 20 / 0.7);
  }
  #generateBtn:disabled {
    cursor: not-allowed;
    background: #d1a1a1;
    box-shadow: none;
  }

  #treeContainer {
    position: relative;
    width: 100%;
    max-width: 900px;
    height: 600px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgb(0 0 0 / 0.1);
    overflow: auto;
    padding: 1rem;
    scrollbar-width: thin;
    scrollbar-color: #b71c1c #f8d7d7;
  }
  #treeContainer::-webkit-scrollbar {
    height: 8px;
    width: 8px;
  }
  #treeContainer::-webkit-scrollbar-thumb {
    background-color: #b71c1c;
    border-radius: 4px;
  }
  #treeContainer::-webkit-scrollbar-track {
    background-color: #f8d7d7;
  }

  .node {
    position: absolute;
    width: 55px;
    height: 55px;
    border-radius: 50%;
    color: white;
    font-weight: 700;
    font-size: 1.3rem;
    display: flex;
    justify-content: center;
    align-items: center;
    border: 2.5px solid rgba(0,0,0,0.15);
    user-select: none;
    box-shadow: 0 3px 6px rgb(0 0 0 / 0.2);
    transition: transform 0.3s ease;
  }
  .node:hover {
    transform: scale(1.15);
    box-shadow: 0 6px 12px rgb(0 0 0 / 0.35);
    z-index: 10;
  }
  .red {
    background-color: #b71c1c;
    border-color: #7f1414;
    text-shadow: 0 0 5px rgba(0,0,0,0.3);
  }
  .black {
    background-color: #2c2c2c;
    border-color: #1a1a1a;
    text-shadow: 0 0 6px rgba(0,0,0,0.7);
  }

  svg {
    position: absolute;
    top: 0;
    left: 0;
    overflow: visible;
    pointer-events: none;
    z-index: 0;
  }

  footer {
    margin-top: 2rem;
    font-size: 0.9rem;
    color: #777;
  }
</style>
</head>
<body>

<header>
  <h1>Árvore Rubro-negra</h1>
</header>

<button id="generateBtn" aria-label="Gerar árvore vermelho-preta">Gerar Árvore</button>

<div id="treeContainer" aria-live="polite" aria-label="Visualização da árvore"></div>

<footer>© 2025 - Engenharia de computação 2024.1</footer>

<script>
  function createLine(x1, y1, x2, y2) {
    const svgns = "http://www.w3.org/2000/svg";
    const line = document.createElementNS(svgns, 'line');
    line.setAttribute('x1', x1);
    line.setAttribute('y1', y1);
    line.setAttribute('x2', x2);
    line.setAttribute('y2', y2);
    line.setAttribute('stroke', '#4a4a4a');
    line.setAttribute('stroke-width', 2);
    line.setAttribute('stroke-linecap', 'round');
    return line;
  }

  function drawTree(container, treeJson) {
    container.innerHTML = '';

    const svgNS = "http://www.w3.org/2000/svg";
    const svg = document.createElementNS(svgNS, 'svg');
    container.appendChild(svg);

    const levelHeight = 110;
    const nodeSize = 55;

    let levels = [];
    function bfsLevels(node, level = 0) {
      if (!node) return;
      if (!levels[level]) levels[level] = [];
      levels[level].push(node);
      bfsLevels(node.left, level + 1);
      bfsLevels(node.right, level + 1);
    }
    bfsLevels(treeJson);

    const positions = new Map();
    levels.forEach((nodes, level) => {
      const count = nodes.length;
      const containerWidth = container.clientWidth;
      nodes.forEach((node, idx) => {
        const x = (idx + 1) * containerWidth / (count + 1);
        const y = level * levelHeight + 40;
        positions.set(node, { x, y });
      });
    });

    // Desenha linhas
    function drawEdges(node) {
      if (!node) return;
      const pos = positions.get(node);
      if (node.left) {
        const leftPos = positions.get(node.left);
        const line = createLine(pos.x, pos.y, leftPos.x, leftPos.y);
        svg.appendChild(line);
        drawEdges(node.left);
      }
      if (node.right) {
        const rightPos = positions.get(node.right);
        const line = createLine(pos.x, pos.y, rightPos.x, rightPos.y);
        svg.appendChild(line);
        drawEdges(node.right);
      }
    }
    drawEdges(treeJson);

    // Desenha nós
    levels.flat().forEach(node => {
      const pos = positions.get(node);
      const div = document.createElement('div');
      div.classList.add('node');
      div.classList.add(node.color === 'red' ? 'red' : 'black');
      div.style.left = (pos.x - nodeSize / 2) + 'px';
      div.style.top = (pos.y - nodeSize / 2) + 'px';
      div.textContent = node.value;
      container.appendChild(div);
    });

    svg.style.width = container.clientWidth + 'px';
    svg.style.height = container.clientHeight + 'px';
  }

  const btn = document.getElementById('generateBtn');
  const container = document.getElementById('treeContainer');

  btn.addEventListener('click', () => {
    btn.disabled = true;
    btn.textContent = 'Gerando...';

    fetch('/generate')
      .then(res => {
        if (!res.ok) throw new Error('Erro ao gerar árvore');
        return fetch('/tree.json');
      })
      .then(res => {
        if (!res.ok) throw new Error('JSON da árvore não encontrado');
        return res.json();
      })
      .then(json => {
        drawTree(container, json);
        btn.disabled = false;
        btn.textContent = 'Gerar Árvore';
      })
      .catch(err => {
        container.innerHTML = `<p style="color: #b71c1c; font-weight: bold;">Erro: ${err.message}</p>`;
        btn.disabled = false;
        btn.textContent = 'Gerar Árvore';
      });
  });
</script>

</body>
</html>
